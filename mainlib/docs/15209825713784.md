#Java Web开发 Day7(保存用户数据)

####会话
- 购买问题
	- 存储于request中
		- buyServlet与payServlet独立无法共享数据（使用forward技术解决，用户体验差）
		- 保存于Context域中（全局，所有用户共享，也不好）
![屏幕快照 2018-03-14 上午7.18.24-w968](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8A%E5%8D%887.18.24.png)

####Cookie
![屏幕快照 2018-03-14 上午7.28.29](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8A%E5%8D%887.28.29.png)

- 保存用户时间
	
```java
		response.setCharacterEncoding("UTF-8");
		response.setContentType("text/html;charset=UTF-8");
		PrintWriter outPrintWriter = response.getWriter();
		outPrintWriter.print("上一次访问时间");
		//获得用户时间cookie
		Cookie cookies[] = request.getCookies();
		for (int i = 0; cookies!=null&&i < cookies.length; i++) {
			if (cookies[i].getName().equals("lastAccesstime")) {
				//获取毫秒值
				//System.out.println("dsfasadfsdf");
				long cookievalue = Long.parseLong(cookies[i].getValue());
				Date date = new Date(cookievalue);
				outPrintWriter.print(date.toLocaleString());
			}
		}
		//给用户回送新的cookie
		//创建cookie
		Cookie cookie = new Cookie("lastAccesstime", System.currentTimeMillis()+"");
		//设置有效期
		cookie.setMaxAge(3600*24*30);
		//设置有效路径
		cookie.setPath("/d07");
		response.addCookie(cookie);
```

- Cookie细节
![屏幕快照 2018-03-14 上午8.15.03](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8A%E5%8D%888.15.03.png)

####session
![屏幕快照 2018-03-14 下午3.19.15](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8B%E5%8D%883.19.15.png)

- 虽然代码相同，但不同浏览器的各自数据不同
 - HttpSession session = resqest.getsession();
- session.setAttribute("name","洗衣机");
- 配置session有效时间
![屏幕快照 2018-03-14 下午3.40.27](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8B%E5%8D%883.40.27.png)
- getSession(boolean createSession);用于用户查看购物车
- session实现原理：依赖`Cookie`
- 解决关闭浏览器后session消失
![屏幕快照 2018-03-14 下午4.21.43](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8B%E5%8D%884.21.43.png)
- 特殊情况（用户禁用Cookie）
	- 解决方案：URL重写，
	![屏幕快照 2018-03-14 下午4.38.36](media/15209825713784/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202018-03-14%20%E4%B8%8B%E5%8D%884.38.36.png)
- 新建选项卡，使用的同一个session。（不同浏览器，不同）

####session案例
- 大型购物网站使用Cookie



